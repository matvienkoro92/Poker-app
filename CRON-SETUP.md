# Настройка напоминания «за 10 мин» (при закрытом приложении)

Турнир в **понедельник в 5:31 (Бали, UTC+8)** → напоминание «за 10 мин» в **5:21 Бали**.

## Вариант 1: Vercel Cron (встроенный, работает автоматически)

В `vercel.json` уже настроен cron — каждый понедельник в 5:21 по Бали Vercel вызовет API.  
**Нужно:** в Vercel → Settings добавить секретный пароль для вызова. Vercel передаст его при вызове.

## Вариант 2: QStash (если Vercel Cron недоступен)

Используется Upstash QStash — тот же сервис, что и Redis. Расписание создаётся один раз.

### Шаг 1. Настройки в Vercel

В **Settings** добавьте:

- Секретный пароль для вызова (сгенерируйте на https://randomkeygen.com)
- Токен QStash — взять в [Upstash Console](https://console.upstash.com) → QStash (если ещё нет)
- URL и токен Redis, токен бота — если ещё не добавлены

### Шаг 2. Создать расписание

После деплоя откройте в браузере (подставьте свой секрет):

```
https://poker-app-ebon.vercel.app/api/setup-qstash-reminder?key=ВАШ_СЕКРЕТ
```

Должен вернуться `{"ok":true,"message":"QStash schedule created..."}`.

**Либо:** при первой подписке (кнопка «Напомнить за 10 минут») расписание создаётся автоматически.

### Итог

Расписание в QStash будет вызывать API каждый понедельник в 5:21 по Бали и отправлять сообщения всем подписчикам, даже если приложение закрыто.

---

## Вариант 3: cron-job.org (запасной)

Если QStash недоступен:

1. Зарегистрируйтесь на https://cron-job.org
2. **Create Cronjob:**
   - URL: `https://poker-app-ebon.vercel.app/api/freeroll-reminder-send?when=10min&secret=ВАШ_СЕКРЕТ`
   - Schedule: **Каждый понедельник, 05:21** (часовой пояс **Asia/Makassar**)

---

## Тест и проверка

- **Тест в приложении** — «Тест: отправить «за 10 мин» сейчас»
- **Проверка подписчиков** — `/api/debug-env?reminders=1` (если `subscribers10min` = 0 — нажмите «Напомнить за 10 минут»)
