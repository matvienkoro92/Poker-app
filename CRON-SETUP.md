# Настройка напоминаний «за час» и «за 10 мин»

Турнир в **понедельник в 5:00 (Бали, UTC+8)** → напоминание «за час» в **4:00 Бали**, «за 10 мин» в **4:50 Бали** (только понедельник).

## ⚠️ Vercel Hobby: Cron не подходит

На бесплатном плане Vercel Cron — **максимум раз в день**. Два напоминания (4:00 и 4:50 Бали) не успеют оба сработать. **Используйте cron-job.org** (ниже).

## Шаг 1. Добавить CRON_SECRET в Vercel

1. Сгенерируйте пароль: https://randomkeygen.com
2. Vercel → **Settings** → **Environment Variables**
3. Добавьте:
   - **Name:** `CRON_SECRET`
   - **Value:** сгенерированный пароль
4. **Save** → **Redeploy**

## Шаг 2. cron-job.org (обязательно, 2 отдельных задачи)

⚠️ **Важно:** нужны ДВЕ отдельные задачи. Без второй «за 10 мин» — не придёт.

1. Зарегистрируйтесь на https://cron-job.org
2. **Create Cronjob #1** (за час):
   - URL: `https://poker-app-ebon.vercel.app/api/freeroll-reminder-send?when=1h&secret=ВАШ_CRON_SECRET`
   - Schedule: **Каждый понедельник, 04:00** (часовой пояс **Asia/Makassar**)
   - Включите задачу (Enabled)
3. **Create Cronjob #2** (за 10 мин):
   - URL: `https://poker-app-ebon.vercel.app/api/freeroll-reminder-send?when=10min&secret=ВАШ_CRON_SECRET`
   - Schedule: **Каждый понедельник, 04:50** (часовой пояс **Asia/Makassar**)
   - Включите задачу (Enabled)

## Тест вручную

В приложении — кнопки «Тест: отправить «за час» сейчас» и «Тест: отправить «за 10 мин» сейчас» (работают без CRON_SECRET).

Через браузер (подставьте свой CRON_SECRET, без initData разошлёт всем подписчикам):
- `https://poker-app-ebon.vercel.app/api/freeroll-reminder-send?when=1h&secret=ВАШ_CRON_SECRET`
- `https://poker-app-ebon.vercel.app/api/freeroll-reminder-send?when=10min&secret=ВАШ_CRON_SECRET`

## Проверка подписчиков

Откройте `/api/debug-env?reminders=1` — увидите, сколько подписчиков в «за час» и «за 10 мин». Если 0 — нажмите кнопку в приложении для подписки.

## «За 10 мин» не приходит — что проверить

1. **Две задачи в cron-job.org** — вторая задача с `when=10min` создана и включена?
2. **Подписка** — вы отметили чекбокс «Напомнить за 10 минут»? (Отдельно от «за час»)
3. **Проверка подписчиков** — откройте `/api/debug-env?reminders=1`. Если `subscribers10min` = 0 — никто не подписан.
4. **Тест** — в приложении нажмите «Тест: отправить «за 10 мин» сейчас». Если пришло — доставка работает, проблема в cron.
5. **CRON_SECRET** — в URL второй задачи тот же `secret`, что в Vercel.

## Итог

После настройки отметьте в приложении «Напомнить за час» и/или «Напомнить за 10 минут» — подписка сохранится. Сообщения придут в понедельник в 4:00 и 4:50 по Бали (если cron-job.org вызывает URL вовремя).
